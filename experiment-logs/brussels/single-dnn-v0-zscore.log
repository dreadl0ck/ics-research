2020-02-08 12:38:51.834783: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libnvinfer.so.6'; dlerror: libnvinfer.so.6: cannot open shared object file: No such file or directory
2020-02-08 12:38:51.834836: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libnvinfer_plugin.so.6'; dlerror: libnvinfer_plugin.so.6: cannot open shared object file: No such file or directory
2020-02-08 12:38:51.834843: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:30] Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
2020-02-08 12:38:52.328648: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2020-02-08 12:38:52.328668: E tensorflow/stream_executor/cuda/cuda_driver.cc:351] failed call to cuInit: UNKNOWN ERROR (303)
2020-02-08 12:38:52.328682: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (brussels): /proc/driver/nvidia/version does not exist
2020-02-08 12:38:52.328789: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2020-02-08 12:38:52.349791: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3312000000 Hz
2020-02-08 12:38:52.349980: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x59fdf70 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-02-08 12:38:52.349991: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
Using TensorFlow backend.
WARNING:tensorflow:Large dropout rate: 0.8 (>0.5). In TensorFlow 2.x, dropout() uses dropout rate instead of keep_prob. Please ensure that this is intended.
=================================================
        TRAINING v0.4.2 (binaryClasses)
=================================================
Date: 2020-02-08 12:38:52.325569
[33m[INFO] using Sequential Dense layers[0m
[INFO] adding core layer 0
wrapLayerSize 2
coreLayerSize 4
numCoreLayers 1
outputLayerActivation softmax
output_dim 1
loss categorical_crossentropy
optimizer adam
[INFO] created DNN
[33m[INFO] epoch 1/3[0m
[33m[INFO] loading file 1-2/1 on epoch 1/3[0m
[INFO] reading file data/SWaT2015-Attack-Files-v0.4-zscore/train/2015-12-28_113021_98.log.part12_sorted-labeled.csv
[INFO] concatenate the files
[INFO] process dataset, shape: (500000, 18)
[INFO] sampling 1.0
[33mdropping column: modbus_value[0m
dropping all time related columns...
[33mdropping column: unixtime[0m
[INFO] columns: Index(['orig', 'type', 'i/f_name', 'i/f_dir', 'src', 'dst', 'proto',
       'appi_name', 'proxy_src_ip', 'modbus_function_code',
       'modbus_function_description', 'modbus_transaction_id', 'scada_tag',
       'service', 's_port', 'classification'],
      dtype='object')
[INFO] analyze dataset: (500000, 16)

[INFO] analyzing data
[INFO] 500000 rows
[INFO] ** orig:[0.0:100.0%]
[INFO] ** type:[1.0:99.9998%,-1.0:0.0002%]
[INFO] ** i/f_name:[-1.0:99.9988%,0.0:0.0012%]
[INFO] ** i/f_dir:[-0.7071067812:99.9988%,0.7071067812:0.0012%]
[INFO] ** src:[-1.3652730819:38.4088%,1.3652730819:25.8982%,0.5251050315:18.1636%,-0.5251050315:17.5218%,-1.5753150944999998:0.0014%,-0.9451890567:0.0014%,-1.1552310693:0.0012%,-0.7351470441:0.001%,1.5753150944999998:0.001%,0.9451890567:0.0006%,0.10502100630000001:0.0004%,-0.3150630189:0.0004%,0.3150630189:0.0002%]
[INFO] ** dst:[-1.0302443927:43.266%,1.4048787174000001:21.0416%,1.2175615551:18.1634%,0.0936585812:17.5214%,-0.4682929058:0.0016%,0.4682929058:0.0012%,-0.6556100681:0.0012%,-1.5921958797:0.001%,-0.0936585812:0.0006%,0.6556100681:0.0004%,1.5921958797:0.0004%,0.8429272304000001:0.0004%,0.28097574350000004:0.0004%,-0.8429272304000001:0.0002%,-1.4048787174000001:0.0002%]
[INFO] ** proto:[0.0:99.996%,1.0:0.0028%,-1.0:0.0012%]
[INFO] ** appi_name:[-1.6378460497:99.9928%,-1.5118578919999999:0.0012%,-0.25197631530000003:0.001%,0.8819171037000001:0.0008%,-0.6299407883:0.0006%,-1.3858697344:0.0006%,0.1259881577:0.0006%,-0.1259881577:0.0004%,1.3858697344:0.0004%,-1.133893419:0.0004%,0.37796447299999997:0.0002%,-0.5039526307:0.0002%,1.5118578919999999:0.0002%,0.25197631530000003:0.0002%,-1.2598815767:0.0002%,-0.37796447299999997:0.0002%]
[INFO] ** proxy_src_ip:[0.5251050315:38.4088%,-1.5753150944999998:25.8982%,1.3652730819:18.1636%,-0.3150630189:17.5218%,-1.1552310693:0.0014%,-1.3652730819:0.0014%,0.10502100630000001:0.0012%,0.7351470441:0.001%,0.9451890567:0.001%,-0.10502100630000001:0.0006%,0.3150630189:0.0004%,1.5753150944999998:0.0004%,-0.5251050315:0.0002%]
[INFO] ** modbus_function_code:[0.005653795200000001:99.9928%,-176.7993450566:0.007%,4.6584169229:0.0002%]
[INFO] ** modbus_function_description:[-0.8017837256999999:49.9974%,-1.3363062096:49.9954%,-0.2672612419:0.007%,0.2672612419:0.0002%]
[INFO] ** modbus_transaction_id:65536 (13.1072%)
[INFO] ** scada_tag:[1.3363062096:25.8976%,0.2672612419:21.0406%,0.8017837256999999:18.163%,-1.3363062096:17.521%,-0.2672612419:17.3678%,-0.8017837256999999:0.01%]
[INFO] ** service:[0.0054950911:99.9936%,-185.27759935790002:0.0012%,-184.7112245991:0.001%,-184.7029563544:0.0008%,-179.7709484184:0.0008%,-184.71949284369998:0.0006%,-163.13937429709998:0.0006%,-184.7070904767:0.0006%,-163.1476425417:0.0004%,-162.746632676:0.0002%,-177.4227669367:0.0002%]
[INFO] ** s_port:[1.4631574735:25.8978%,-0.2976951931:21.0408%,-1.2442195994:18.1632%,-0.2104457366:17.5212%,-0.3109148077:17.368%,-70.70536262659999:0.0012%,-70.5242539064:0.001%,-2.1087823952:0.0008%,-0.2183775054:0.0006%,-70.522931945:0.0006%,-2.3877162634999998:0.0004%,4.4269950699:0.0004%,-63.6289029238:0.0004%,-0.9904029989:0.0004%,-57.521440972200004:0.0002%,4.0634556680000005:0.0002%,-43.372487451000005:0.0002%,1.4737331652:0.0002%,10.6005550946:0.0002%,-5.0818737219:0.0002%,4.2842232321:0.0002%,-1.2415756765000001:0.0002%,1.4843088569:0.0002%,2.0593620926:0.0002%,-57.518797049300005:0.0002%,14.1539875028:0.0002%,-5.0223854561:0.0002%,-68.19363585:0.0002%,-1.2389317536:0.0002%,6.080768858099999:0.0002%]
[INFO] ** classification:[normal:79.2972%,Single Stage Single Point:20.7028%]
[INFO] columns with count within 2-10 {'type': 2, 'i/f_name': 2, 'i/f_dir': 2, 'proto': 3, 'modbus_function_code': 3, 'modbus_function_description': 4, 'scada_tag': 6, 'classification': 2}
--------------AFTER DROPPING COLUMNS ----------------
df.columns Index(['orig', 'type', 'i/f_name', 'i/f_dir', 'src', 'dst', 'proto',
       'appi_name', 'proxy_src_ip', 'modbus_function_code',
       'modbus_function_description', 'modbus_transaction_id', 'scada_tag',
       'service', 's_port', 'classification'],
      dtype='object') 16
        orig  type  i/f_name   i/f_dir       src       dst  proto  appi_name  \
0        0.0   1.0      -1.0 -0.707107 -1.365273 -1.030244    0.0  -1.637846   
1        0.0   1.0      -1.0 -0.707107  1.365273 -1.030244    0.0  -1.637846   
2        0.0   1.0      -1.0 -0.707107  0.525105  1.217562    0.0  -1.637846   
3        0.0   1.0      -1.0 -0.707107 -0.525105  0.093659    0.0  -1.637846   
4        0.0   1.0      -1.0 -0.707107 -1.365273  1.404879    0.0  -1.637846   
...      ...   ...       ...       ...       ...       ...    ...        ...   
499995   0.0   1.0      -1.0 -0.707107  0.525105  1.217562    0.0  -1.637846   
499996   0.0   1.0      -1.0 -0.707107 -1.365273  1.404879    0.0  -1.637846   
499997   0.0   1.0      -1.0 -0.707107 -1.365273 -1.030244    0.0  -1.637846   
499998   0.0   1.0      -1.0 -0.707107 -1.365273  1.404879    0.0  -1.637846   
499999   0.0   1.0      -1.0 -0.707107  0.525105  1.217562    0.0  -1.637846   

        proxy_src_ip  modbus_function_code  modbus_function_description  \
0           0.525105              0.005654                    -0.801784   
1          -1.575315              0.005654                    -0.801784   
2           1.365273              0.005654                    -1.336306   
3          -0.315063              0.005654                    -1.336306   
4           0.525105              0.005654                    -1.336306   
...              ...                   ...                          ...   
499995      1.365273              0.005654                    -1.336306   
499996      0.525105              0.005654                    -1.336306   
499997      0.525105              0.005654                    -1.336306   
499998      0.525105              0.005654                    -0.801784   
499999      1.365273              0.005654                    -0.801784   

        modbus_transaction_id  scada_tag   service    s_port  \
0                   -1.367964  -0.267261  0.005495 -0.310915   
1                   -1.559670   1.336306  0.005495  1.463157   
2                    0.900796   0.801784  0.005495 -1.244220   
3                    0.776745  -1.336306  0.005495 -0.210446   
4                   -1.388789   0.267261  0.005495 -0.297695   
...                       ...        ...       ...       ...   
499995              -1.281810   0.801784  0.005495 -1.244220   
499996               0.245761   0.267261  0.005495 -0.297695   
499997               0.738266  -0.267261  0.005495 -0.310915   
499998               0.245761   0.267261  0.005495 -0.297695   
499999              -1.281810   0.801784  0.005495 -1.244220   

                   classification  
0                          normal  
1                          normal  
2                          normal  
3                          normal  
4                          normal  
...                           ...  
499995                     normal  
499996  Single Stage Single Point  
499997                     normal  
499998  Single Stage Single Point  
499999                     normal  

[500000 rows x 16 columns]
[INFO] processing batch 0-100000/500000
[INFO] breaking into predictors and prediction...
CHUNK ANALYZE

[INFO] analyzing data
[INFO] 100000 rows
[INFO] ** orig:[0.0:100.0%]
[INFO] ** type:[1.0:100.0%]  File "train.py", line 359, in <module>
    run()
  File "train.py", line 264, in run
    history = train_dnn(dfCopy, i, epoch+1, batch=batch_size)
  File "train.py", line 116, in train_dnn
    epochs=1,
  File "/usr/local/lib/python3.6/dist-packages/keras/engine/training.py", line 1154, in fit
    batch_size=batch_size)
  File "/usr/local/lib/python3.6/dist-packages/keras/engine/training.py", line 637, in _standardize_user_data
    training_utils.check_array_length_consistency(x, y, sample_weights)
  File "/usr/local/lib/python3.6/dist-packages/keras/engine/training_utils.py", line 244, in check_array_length_consistency
    'and ' + str(list(set_y)[0]) + ' target samples.')

[INFO] ** i/f_name:[-1.0:99.998%,0.0:0.002%]
[INFO] ** i/f_dir:[-0.7071067812:99.998%,0.7071067812:0.002%]
[INFO] ** src:[-1.3652730819:38.321%,1.3652730819:25.909%,0.5251050315:18.237%,-0.5251050315:17.521%,-0.9451890567:0.007%,-1.5753150944999998:0.003%,-1.1552310693:0.002%]
[INFO] ** dst:[-1.0302443927:43.251%,1.4048787174000001:20.978%,1.2175615551:18.237%,0.0936585812:17.522%,-0.4682929058:0.004%,1.5921958797:0.002%,-0.6556100681:0.002%,0.28097574350000004:0.002%,-1.4048787174000001:0.001%,-0.0936585812:0.001%]
[INFO] ** proto:[0.0:99.99%,1.0:0.008%,-1.0:0.002%]
[INFO] ** appi_name:[-1.6378460497:99.988%,-0.25197631530000003:0.002%,-1.5118578919999999:0.002%,1.3858697344:0.002%,-1.3858697344:0.002%,1.5118578919999999:0.001%,-0.6299407883:0.001%,-0.1259881577:0.001%,-1.133893419:0.001%]
[INFO] ** proxy_src_ip:[0.5251050315:38.321%,-1.5753150944999998:25.909%,1.3652730819:18.237%,-0.3150630189:17.521%,-1.3652730819:0.007%,-1.1552310693:0.003%,0.10502100630000001:0.002%]
[INFO] ** modbus_function_code:[0.005653795200000001:99.988%,-176.7993450566:0.012%]
[INFO] ** modbus_function_description:[-0.8017837256999999:49.994%,-1.3363062096:49.994%,-0.2672612419:0.012%]
[INFO] ** modbus_transaction_id:40551 (40.551%)
[INFO] ** scada_tag:[1.3363062096:25.908%,0.2672612419:20.978%,0.8017837256999999:18.237%,-1.3363062096:17.521%,-0.2672612419:17.342%,-0.8017837256999999:0.014%]
[INFO] ** service:[0.0054950911:99.988%,-185.27759935790002:0.002%,-184.7070904767:0.002%,-163.1476425417:0.002%,-184.7029563544:0.002%,-184.7112245991:0.002%,-163.13937429709998:0.001%,-177.4227669367:0.001%]
[INFO] ** s_port:[1.4631574735:25.908%,-0.2976951931:20.978%,-1.2442195994:18.237%,-0.2104457366:17.521%,-0.3109148077:17.343%,-63.6289029238:0.002%,-70.70536262659999:0.002%,-70.5242539064:0.002%,-70.522931945:0.002%,-2.3877162634999998:0.002%,14.1539875028:0.001%,1.4843088569:0.001%,-68.19363585:0.001%]
[INFO] ** classification:[normal:100.0%]
[INFO] columns with count within 2-10 {'i/f_name': 2, 'i/f_dir': 2, 'src': 7, 'proto': 3, 'appi_name': 9, 'proxy_src_ip': 7, 'modbus_function_code': 2, 'modbus_function_description': 3, 'scada_tag': 6, 'service': 8}
[INFO] to_xy labeltype: normal
indices (array([    0,     1,     2, ..., 99997, 99998, 99999]),)
y_vector [[1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 ...
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]]
z vector sum [100000.      0.      0.      0.      0.]
[INFO] to_xy labeltype: Single Stage Single Point
indices (array([], dtype=int64),)
y_vector [[1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 ...
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]]
z vector sum [100000.      0.      0.      0.      0.]
[INFO] to_xy labeltype: Single Stage Multi Point
indices (array([], dtype=int64),)
y_vector [[1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 ...
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]]
z vector sum [100000.      0.      0.      0.      0.]
[INFO] to_xy labeltype: Multi Stage Single Point
indices (array([], dtype=int64),)
y_vector [[1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 ...
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]]
z vector sum [100000.      0.      0.      0.      0.]
[INFO] to_xy labeltype: Multi Stage Multi Point
indices (array([], dtype=int64),)
y_vector [[1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 ...
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]
 [1. 0. 0. 0. 0.]]
z vector sum [100000.      0.      0.      0.      0.]
[INFO] creating train/test split: 0.5
--------SHAPES--------
x_train.shape (50000, 15)
x_test.shape (50000, 15)
y_train.shape (50000, 5)
y_test.shape (50000, 5)
Model: "sequential_1"
_________________________________________________________________
Layer (type)                 Output Shape              Param #   
=================================================================
dense_1 (Dense)              (None, 2)                 4         
_________________________________________________________________
dropout_1 (Dropout)          (None, 2)                 0         
_________________________________________________________________
dense_2 (Dense)              (None, 4)                 12        
_________________________________________________________________
dropout_2 (Dropout)          (None, 4)                 0         
_________________________________________________________________
dense_3 (Dense)              (None, 2)                 10        
_________________________________________________________________
dropout_3 (Dropout)          (None, 2)                 0         
_________________________________________________________________
dense_4 (Dense)              (None, 1)                 3         
=================================================================
Total params: 29
Trainable params: 29
Non-trainable params: 0
_________________________________________________________________
[INFO] fitting model
[EXCEPTION] (<class 'ValueError'>, ValueError('Input arrays should have the same number of samples as target arrays. Found 750000 input samples and 250000 target samples.',), <traceback object at 0x7fa7982e4848>)
--- 1.3698513507843018 seconds ---
2020-02-08 12:38:54.553746: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libnvinfer.so.6'; dlerror: libnvinfer.so.6: cannot open shared object file: No such file or directory
2020-02-08 12:38:54.553791: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libnvinfer_plugin.so.6'; dlerror: libnvinfer_plugin.so.6: cannot open shared object file: No such file or directory
2020-02-08 12:38:54.553803: W tensorflow/compiler/tf2tensorrt/utils/py_utils.cc:30] Cannot dlopen some TensorRT libraries. If you would like to use Nvidia GPU with TensorRT, please make sure the missing libraries mentioned above are installed properly.
2020-02-08 12:38:55.047852: W tensorflow/stream_executor/platform/default/dso_loader.cc:55] Could not load dynamic library 'libcuda.so.1'; dlerror: libcuda.so.1: cannot open shared object file: No such file or directory
2020-02-08 12:38:55.047872: E tensorflow/stream_executor/cuda/cuda_driver.cc:351] failed call to cuInit: UNKNOWN ERROR (303)
2020-02-08 12:38:55.047886: I tensorflow/stream_executor/cuda/cuda_diagnostics.cc:156] kernel driver does not appear to be running on this host (brussels): /proc/driver/nvidia/version does not exist
2020-02-08 12:38:55.047985: I tensorflow/core/platform/cpu_feature_guard.cc:142] Your CPU supports instructions that this TensorFlow binary was not compiled to use: AVX2 FMA
2020-02-08 12:38:55.069811: I tensorflow/core/platform/profile_utils/cpu_utils.cc:94] CPU Frequency: 3312000000 Hz
2020-02-08 12:38:55.070002: I tensorflow/compiler/xla/service/service.cc:168] XLA service 0x4054ca0 initialized for platform Host (this does not guarantee that XLA will be used). Devices:
2020-02-08 12:38:55.070013: I tensorflow/compiler/xla/service/service.cc:176]   StreamExecutor device (0): Host, Default Version
Using TensorFlow backend.
WARNING:tensorflow:Large dropout rate: 0.8 (>0.5). In TensorFlow 2.x, dropout() uses dropout rate instead of keep_prob. Please ensure that this is intended.
  File "score.py", line 282, in <module>
    run()
  File "score.py", line 70, in run
    print("loading file", weight_files[-1])
=================================================
        SCORING v0.4.2 (binaryClasses)
=================================================
Date: 2020-02-08 12:38:55.044750
[33m[INFO] using Sequential Dense layers[0m
[INFO] adding core layer 0
wrapLayerSize 2
coreLayerSize 4
numCoreLayers 1
outputLayerActivation softmax
output_dim 1
loss sparse_categorical_crossentropy
optimizer adam
[INFO] created DNN
loading weights: checkpoints/*
[EXCEPTION] (<class 'IndexError'>, IndexError('list index out of range',), <traceback object at 0x7f3ec05542c8>)
--- 0.17325568199157715 seconds ---
